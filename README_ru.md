## RPG CLI — пошаговый автобаттлер (Go + ncurses)

#### Мини-игра в терминале: создаёшь персонажа, выбираешь класс, а дальше сражения идут автоматически. Твоя роль — принимать решения между боями: прокачка и оружие. Цель — выиграть 5 боёв подряд.

#### Возможности

Терминальный UI на ncurses: рамки игрока/врага, центр — лог боя.

Автобой по ходам с таймером 2s между действиями.

Инициатива, промахи/попадания, детальный пайплайн урона.

#### Классы и эффекты:

Warrior: Action Surge (рывок), Shield (щит), STR +1 на 3-м уровне.

Barbarian: Rage (ярость), Stone Skin (каменная кожа), STA +1 на 3-м уровне.

Rogue: Sneak Attack (скрытая атака), AGI +1 на 2-м уровне, Poison (яд) на 3-м.

Особенности врагов (иммунитеты/уязвимости/перки).

Лут с выпадением оружия и модалкой сравнения/смены.

Прогрессия: мультикласс до суммарного 3 уровня, лечение после победы.

Серия из 5 побед → экран завершения.

Набор юнит-тестов на ключевые эффекты и вычисления.

#### Как играть

Сборка и запуск

Понадобится:

Go 1.20+

Библиотека ncurses:

macOS: brew install ncurses

Ubuntu/Debian: sudo apt-get install libncurses5-dev libncursesw5-dev

Arch: sudo pacman -S ncurses

Windows: WSL/WSL2 с Linux-дистрибутивом

go run ./cmd/game

#### Как устроен бой

Инициатива: ходит тот, у кого выше AGI; при равенстве — игрок.

Попадание: случайный бросок в диапазоне [1 .. (AGI_att + AGI_def)]; ≤ AGI_def — промах.

Пайплайн урона:

База: weapon + STR.

Атакующие бонусы: Action Surge, Rage, Sneak Attack, Dragon Breath.

Частичные защиты: иммун/уязвимость, влияющие только на оружейную часть
(например, иммун к рубящему обнуляет оружейную часть рубящего типа; уязвимость к дробящему удваивает её).

Глобальные защиты: Shield (−3 при STR_def > STR_att), Stone Skin (−STA_def).

Отсечка снизу: итог не ниже 0.

Яд: накладывается при попадании с соответствующим перком; тикает на ходу жертвы: +1 на её 2-м ходе, +2 на 3-м и дальше (с учётом глобальных защит).

Тайминг: одна попытка атаки каждые ~2 секунды (логика тайминга в UI; расчёты — в домене).

#### Прогрессия и лут

Повышение уровня: при апгрейде растёт MaxHP на (HP per level класса) + STA (сначала применяются атрибутные бонусы уровня, затем считается прирост HP).

Перки: включаются по уровням соответствующего класса.

Лут: после победы предложение заменить текущее оружие на дроп врага (сравнение в модалке). Таблица дропа лежит в internal/loot и легко меняется (интерфейс LootTable).

#### Тестирование

Команда из корневой директории:

go test ./internal/domain -v

Покрытие включает:

тай-брейк инициативы;

Action Surge (как бонус, не режется иммунитетом оружейной части);

уязвимость к дробящему (только оружейная часть);

Rage по ходам (+2/+2/+2/−1);

Dragon Breath на каждом 3-м своём ходу;

Shield/Stone Skin как глобальные редукции;

Отсечку урона до нуля;

Корректные тики яда.

#### Расширяемость

SOLID:

SRP: domain занимается чистыми расчётами, ui/term — только отрисовка, loot — данные контента.

OCP: новые враги/эффекты/оружие добавляются данными и изолированными расширениями, без переписывания остального.

DIP: loot зашит через интерфейс — можно подменить реализацию (весовые дропы и т.п.) без изменений в логике.

Новые эффекты удобнее добавлять как флаги/параметры в Perks + обработку в пайплайне урона; UI их не знает и не меняется.

